FROM confluentinc/cp-kafka:7.4.0

# Configurações específicas para Railway
ENV KAFKA_BROKER_ID=${KAFKA_BROKER_ID:-1}
ENV KAFKA_ZOOKEEPER_CONNECT=${KAFKA_ZOOKEEPER_CONNECT:-zookeeper:2181}
ENV KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
ENV KAFKA_INTER_BROKER_LISTENER_NAME=PLAINTEXT
ENV KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
ENV KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0
ENV KAFKA_AUTO_CREATE_TOPICS_ENABLE=true

# Expor portas
EXPOSE 9092 9101

# Script de inicialização para Railway
COPY start-kafka.sh /start-kafka.sh

CMD ["sh", "/start-kafka.sh"]
